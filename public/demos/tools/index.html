<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¼€å‘å·¥å…·æ¼”ç¤º - CLI & æµ‹è¯•æ–¹æ³•</title>
    <link rel="stylesheet" href="../../css/demo.css">
</head>
<body>
    <div class="demo-container">
        <header class="demo-header">
            <h1>å¼€å‘å·¥å…·æ¼”ç¤º</h1>
            <p class="demo-subtitle">å­¦ä¹ ä½¿ç”¨ Stripe CLI å’Œæµ‹è¯•æ–¹æ³•</p>
        </header>

        <div class="demo-content">
            <section class="demo-section">
                <h2>1. Stripe CLI å‘½ä»¤</h2>
                <p>å¸¸ç”¨çš„ Stripe CLI å‘½ä»¤å’Œç”¨æ³•ï¼š</p>

                <div class="cli-commands">
                    <div class="cli-command">
                        <h3>ç™»å½•</h3>
                        <div class="code-block">
                            <div class="code-header">
                                <span>ç™»å½•åˆ° Stripe è´¦æˆ·</span>
                                <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                            </div>
                            <pre><code>stripe login</code></pre>
                        </div>
                    </div>

                    <div class="cli-command">
                        <h3>è½¬å‘ Webhook</h3>
                        <div class="code-block">
                            <div class="code-header">
                                <span>è½¬å‘ Webhook åˆ°æœ¬åœ°æœåŠ¡å™¨</span>
                                <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                            </div>
                            <pre><code>stripe listen --forward-to localhost:3000/webhook</code></pre>
                        </div>
                    </div>

                    <div class="cli-command">
                        <h3>è§¦å‘æµ‹è¯•äº‹ä»¶</h3>
                        <div class="code-block">
                            <div class="code-header">
                                <span>è§¦å‘ payment_intent.succeeded äº‹ä»¶</span>
                                <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                            </div>
                            <pre><code>stripe trigger payment_intent.succeeded</code></pre>
                        </div>
                    </div>

                    <div class="cli-command">
                        <h3>åˆ›å»ºæµ‹è¯•èµ„æº</h3>
                        <div class="code-block">
                            <div class="code-header">
                                <span>åˆ›å»ºæµ‹è¯•å®¢æˆ·</span>
                                <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                            </div>
                            <pre><code>stripe fixtures customers create</code></pre>
                        </div>
                    </div>
                </div>
            </section>

            <section class="demo-section">
                <h2>2. æµ‹è¯•å¡å·</h2>
                <p>ä½¿ç”¨æµ‹è¯•å¡å·æ¨¡æ‹Ÿä¸åŒçš„æ”¯ä»˜åœºæ™¯ï¼š</p>

                <div class="test-cards">
                    <div class="test-card">
                        <div class="card-icon">âœ…</div>
                        <h3>æˆåŠŸæ”¯ä»˜</h3>
                        <div class="card-number">4242 4242 4242 4242</div>
                        <p>ç”¨äºæµ‹è¯•æˆåŠŸçš„æ”¯ä»˜æµç¨‹</p>
                        <button class="btn btn-success" onclick="testCard('4242424242424242')">æµ‹è¯•æ­¤å¡</button>
                    </div>

                    <div class="test-card">
                        <div class="card-icon">âŒ</div>
                        <h3>æ”¯ä»˜å¤±è´¥</h3>
                        <div class="card-number">4000 0000 0000 0002</div>
                        <p>ç”¨äºæµ‹è¯•æ”¯ä»˜å¤±è´¥åœºæ™¯</p>
                        <button class="btn btn-danger" onclick="testCard('4000000000000002')">æµ‹è¯•æ­¤å¡</button>
                    </div>

                    <div class="test-card">
                        <div class="card-icon">ğŸ”</div>
                        <h3>éœ€è¦ 3D éªŒè¯</h3>
                        <div class="card-number">4000 0025 0000 3155</div>
                        <p>ç”¨äºæµ‹è¯• 3D Secure éªŒè¯æµç¨‹</p>
                        <button class="btn btn-warning" onclick="testCard('4000002500003155')">æµ‹è¯•æ­¤å¡</button>
                    </div>

                    <div class="test-card">
                        <div class="card-icon">ğŸ’³</div>
                        <h3>ä½™é¢ä¸è¶³</h3>
                        <div class="card-number">4000 0000 0000 9995</div>
                        <p>ç”¨äºæµ‹è¯•ä½™é¢ä¸è¶³åœºæ™¯</p>
                        <button class="btn btn-danger" onclick="testCard('4000000000009995')">æµ‹è¯•æ­¤å¡</button>
                    </div>
                </div>
            </section>

            <section class="demo-section">
                <h2>3. æµ‹è¯•æ”¯ä»˜æµç¨‹</h2>
                <p>ä½¿ç”¨æµ‹è¯•å¡è¿›è¡Œå®Œæ•´çš„æ”¯ä»˜æµ‹è¯•ï¼š</p>

                <div class="demo-panel">
                    <div class="form-group">
                        <label for="testAmount">æ”¯ä»˜é‡‘é¢ï¼ˆå…ƒï¼‰</label>
                        <input type="number" id="testAmount" value="100" min="1">
                    </div>
                    <div class="form-group">
                        <label for="testCardNumber">æµ‹è¯•å¡å·</label>
                        <input type="text" id="testCardNumber" placeholder="4242 4242 4242 4242" maxlength="19">
                    </div>
                    <div class="form-group">
                        <label for="testExpiry">è¿‡æœŸæ—¥æœŸ</label>
                        <input type="text" id="testExpiry" placeholder="12/34" maxlength="5">
                    </div>
                    <div class="form-group">
                        <label for="testCvc">CVC</label>
                        <input type="text" id="testCvc" placeholder="123" maxlength="4">
                    </div>
                    <div class="form-group">
                        <label for="testZip">é‚®æ”¿ç¼–ç </label>
                        <input type="text" id="testZip" placeholder="12345" maxlength="5">
                    </div>
                    <button class="btn btn-primary" onclick="testPayment()">æµ‹è¯•æ”¯ä»˜</button>
                </div>

                <div class="result-panel" id="testPaymentResult" style="display: none;">
                    <h3>æµ‹è¯•ç»“æœ</h3>
                    <div id="testPaymentContent"></div>
                </div>
            </section>

            <section class="demo-section">
                <h2>4. å¸¸è§é—®é¢˜æ’æŸ¥</h2>
                <p>å¸¸è§é”™è¯¯å’Œè§£å†³æ–¹æ¡ˆï¼š</p>

                <div class="troubleshooting">
                    <div class="troubleshoot-item">
                        <h3>API å¯†é’¥é”™è¯¯</h3>
                        <p><strong>é”™è¯¯ä¿¡æ¯ï¼š</strong>Invalid API Key provided</p>
                        <p><strong>åŸå› ï¼š</strong>ä½¿ç”¨äº†é”™è¯¯çš„ API å¯†é’¥æˆ–å¯†é’¥æ ¼å¼ä¸æ­£ç¡®</p>
                        <p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
                        <ul>
                            <li>æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº†æ­£ç¡®çš„å¯†é’¥ï¼ˆæµ‹è¯•å¯†é’¥ vs ç”Ÿäº§å¯†é’¥ï¼‰</li>
                            <li>ç¡®è®¤å¯†é’¥æ ¼å¼æ­£ç¡®ï¼ˆpk_test_... æˆ– sk_test_...ï¼‰</li>
                            <li>é‡æ–°å¤åˆ¶å¯†é’¥å¹¶æ›´æ–°é…ç½®</li>
                        </ul>
                    </div>

                    <div class="troubleshoot-item">
                        <h3>Webhook ç­¾åéªŒè¯å¤±è´¥</h3>
                        <p><strong>é”™è¯¯ä¿¡æ¯ï¼š</strong>Signature verification failed</p>
                        <p><strong>åŸå› ï¼š</strong>Webhook ç­¾åå¯†é’¥ä¸æ­£ç¡®æˆ–ç­¾åéªŒè¯é€»è¾‘æœ‰è¯¯</p>
                        <p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
                        <ul>
                            <li>ç¡®è®¤ä½¿ç”¨äº†æ­£ç¡®çš„ Webhook ç­¾åå¯†é’¥</li>
                            <li>æ£€æŸ¥ç­¾åéªŒè¯ä»£ç æ˜¯å¦æ­£ç¡®</li>
                            <li>ç¡®ä¿æ­£ç¡®å¤„ç†æ—¶é—´æˆ³</li>
                        </ul>
                    </div>

                    <div class="troubleshoot-item">
                        <h3>æ”¯ä»˜å¤±è´¥</h3>
                        <p><strong>é”™è¯¯ä¿¡æ¯ï¼š</strong>Your card was declined</p>
                        <p><strong>åŸå› ï¼š</strong>å¡ç‰‡è¢«æ‹’ç»æˆ–å­˜åœ¨å…¶ä»–é—®é¢˜</p>
                        <p><strong>è§£å†³æ–¹æ¡ˆï¼š</strong></p>
                        <ul>
                            <li>æ£€æŸ¥å¡ç‰‡ä¿¡æ¯æ˜¯å¦æ­£ç¡®</li>
                            <li>ç¡®è®¤å¡ç‰‡æœ‰è¶³å¤Ÿä½™é¢</li>
                            <li>æ£€æŸ¥æ˜¯å¦éœ€è¦ 3D éªŒè¯</li>
                            <li>è”ç³»å‘å¡é“¶è¡Œäº†è§£æ›´å¤šä¿¡æ¯</li>
                        </ul>
                    </div>
                </div>
            </section>

            <section class="demo-section">
                <h2>5. æœ€ä½³å®è·µ</h2>
                <p>Stripe å¼€å‘çš„æœ€ä½³å®è·µå’Œå»ºè®®ï¼š</p>

                <div class="best-practices">
                    <div class="practice-item">
                        <h3>ğŸ”’ å®‰å…¨å®è·µ</h3>
                        <ul>
                            <li>æ°¸è¿œä¸è¦åœ¨å‰ç«¯ä»£ç ä¸­ä½¿ç”¨ç§˜å¯†å¯†é’¥</li>
                            <li>å§‹ç»ˆéªŒè¯ Webhook ç­¾å</li>
                            <li>ä½¿ç”¨ HTTPS è¿›è¡Œæ‰€æœ‰é€šä¿¡</li>
                            <li>å®šæœŸè½®æ¢ API å¯†é’¥</li>
                            <li>å®ç°é€‚å½“çš„é”™è¯¯å¤„ç†</li>
                        </ul>
                    </div>

                    <div class="practice-item">
                        <h3>âš¡ æ€§èƒ½ä¼˜åŒ–</h3>
                        <ul>
                            <li>ä½¿ç”¨å¼‚æ­¥å¤„ç†é¿å…é˜»å¡</li>
                            <li>ç¼“å­˜é¢‘ç¹è®¿é—®çš„æ•°æ®</li>
                            <li>ä½¿ç”¨æ‰¹é‡ API å‡å°‘è¯·æ±‚æ¬¡æ•°</li>
                            <li>å®ç°é‡è¯•é€»è¾‘å¤„ç†ä¸´æ—¶æ€§é”™è¯¯</li>
                        </ul>
                    </div>

                    <div class="practice-item">
                        <h3>ğŸ“Š ç›‘æ§å’Œæ—¥å¿—</h3>
                        <ul>
                            <li>è®°å½•æ‰€æœ‰ API è°ƒç”¨å’Œå“åº”</li>
                            <li>ç›‘æ§é”™è¯¯ç‡å’Œæ€§èƒ½æŒ‡æ ‡</li>
                            <li>è®¾ç½®å‘Šè­¦é€šçŸ¥</li>
                            <li>å®šæœŸå®¡æŸ¥æ—¥å¿—å’Œé”™è¯¯</li>
                        </ul>
                    </div>
                </div>
            </section>
        </div>

        <div class="demo-footer">
            <a href="../../index.html" class="btn btn-secondary">è¿”å›æ•™ç¨‹</a>
            <a href="../../demos.html" class="btn btn-secondary">æŸ¥çœ‹æ‰€æœ‰æ¼”ç¤º</a>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://localhost:3001';
        
        function copyCode(button) {
            const codeBlock = button.parentElement.nextElementSibling;
            const code = codeBlock.textContent;
            
            navigator.clipboard.writeText(code).then(() => {
                button.textContent = 'å·²å¤åˆ¶ï¼';
                setTimeout(() => {
                    button.textContent = 'å¤åˆ¶';
                }, 2000);
            });
        }

        function testCard(cardNumber) {
            document.getElementById('testCardNumber').value = cardNumber;
            document.getElementById('testExpiry').value = '12/34';
            document.getElementById('testCvc').value = '123';
            document.getElementById('testZip').value = '12345';
        }

        async function testPayment() {
            const amount = document.getElementById('testAmount').value;
            const cardNumber = document.getElementById('testCardNumber').value;
            const expiry = document.getElementById('testExpiry').value;
            const cvc = document.getElementById('testCvc').value;
            const zip = document.getElementById('testZip').value;

            if (!cardNumber || !expiry || !cvc) {
                alert('è¯·å¡«å†™æ‰€æœ‰å¿…å¡«å­—æ®µ');
                return;
            }

            const contentDiv = document.getElementById('testPaymentContent');
            contentDiv.innerHTML = '<p class="processing">æ­£åœ¨æµ‹è¯•æ”¯ä»˜...</p>';
            document.getElementById('testPaymentResult').style.display = 'block';

            try {
                const response = await fetch('/api/test-payment', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        amount: Math.round(amount * 100),
                        card_number: cardNumber.replace(/\s/g, ''),
                        card_exp_month: expiry.split('/')[0],
                        card_exp_year: '20' + expiry.split('/')[1],
                        card_cvc: cvc,
                        card_zip: zip
                    })
                });
                const data = await response.json();
                
                contentDiv.innerHTML = `
                    <div class="test-result ${data.success ? 'success' : 'error'}">
                        <h4>${data.success ? 'âœ… æ”¯ä»˜æˆåŠŸ' : 'âŒ æ”¯ä»˜å¤±è´¥'}</h4>
                        <p><strong>Payment Intent IDï¼š</strong> ${data.paymentIntentId || 'N/A'}</p>
                        <p><strong>çŠ¶æ€ï¼š</strong> ${data.status}</p>
                        <p><strong>æ¶ˆæ¯ï¼š</strong> ${data.message}</p>
                        ${data.testCardInfo ? `
                            <div class="test-card-info">
                                <h5>æµ‹è¯•å¡ä¿¡æ¯ï¼š</h5>
                                <p><strong>ç±»å‹ï¼š</strong> ${data.testCardInfo.type}</p>
                                <p><strong>å“ç‰Œï¼š</strong> ${data.testCardInfo.brand}</p>
                                <p><strong>å›½å®¶ï¼š</strong> ${data.testCardInfo.country}</p>
                            </div>
                        ` : ''}
                    </div>
                `;
            } catch (error) {
                contentDiv.innerHTML = `
                    <div class="test-result error">
                        <h4>âŒ æµ‹è¯•å¤±è´¥</h4>
                        <p><strong>é”™è¯¯ï¼š</strong> ${error.message}</p>
                    </div>
                `;
            }
        }
    </script>
</body>
</html>